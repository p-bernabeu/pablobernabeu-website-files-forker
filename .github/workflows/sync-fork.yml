name: Sync Fork from Private Repository

on:
  schedule:  
    # Runs daily at 2 AM UTC
    - cron: '0 2 * * *'
  workflow_dispatch:   # Allows manual triggering

jobs:  
  sync:   
    runs-on: ubuntu-latest
    
    steps:  
      - name: Checkout source repository
        uses: actions/checkout@v4
        with: 
          repository: pablobernabeu/website-files
          token: ${{ secrets.PRIVATE_REPO_PAT }}
          fetch-depth: 0
          path: source-repo
          
      - name:  Checkout destination repository
        uses: actions/checkout@v4
        with: 
          repository: p-bernabeu/pablobernabeu-forker
          token: ${{ secrets.PRIVATE_REPO_PAT }}
          fetch-depth: 0
          path: dest-repo
          
      - name:  Sync content (preserve workflows)
        run: |
          # Save the workflows
          cp -r dest-repo/.github dest-repo/.github-backup
          
          # Sync all content from source
          cd source-repo
          git remote add destination ../dest-repo
          git push destination --force master:main
          git push destination --force --tags
          
          # Restore the workflows
          cd ../dest-repo
          git checkout main
          rm -rf .github/workflows
          cp -r .github-backup/workflows.github/
          rm -rf .github-backup
          
          # Commit and push the restored workflows
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .github/workflows
          git commit -m "Restore sync workflow after sync" || true
          git push origin main
